#MIT License
#Copyright (c) 2018 phR0ze
#
#Permission is hereby granted, free of charge, to any person obtaining a copy
#of this software and associated documentation files (the "Software"), to deal
#in the Software without restriction, including without limitation the rights
#to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
#copies of the Software, and to permit persons to whom the Software is
#furnished to do so, subject to the following conditions:
#
#The above copyright notice and this permission notice shall be included in all
#copies or substantial portions of the Software.
#
#THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
#IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
#FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
#AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
#LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
#OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
#SOFTWARE.

layers:

  # Base
  # ----------------------------------------------------------------------------
  - name: base
    type: machine
    multilib: true
    vars: { fontsize: 10 }
    groups: [lp, wheel, network, storage, users]
    vagrant: { vram: 32, cpus: 2, ram: 2048 }
    boot:
      - entry: "Install <%=distro%>-base        -minimal shell env"
        kernel: /<%=distro%>/vmlinuz
        initrd: /<%=distro%>/intel-ucode.img,/<%=distro%>/initramfs.img ipv6.disable=1 layers=<%=base_layers%> showopts vga=792
      - entry: Hardware Detection Tool
        label: hdt
        kernel: hdt.c32
        noboot: true
      - entry: memory test
        label: memtest
        kernel: memtest
        noboot: true
    packages:
      - { install: machine-core }
      - { install: machine-tools }
      - { install: virtualbox-guest-nox }

    configs:
      - { apply: base-config }

  # Shell
  # ----------------------------------------------------------------------------
  - name: shell
    type: machine
    base: base
    vagrant: { vram: 32, cpus: 2, ram: 2048 }
    boot:
      - entry: "Install <%=distro%>-shell        -base + full shell dev env"
        kernel: /<%=distro%>/vmlinuz
        initrd: /<%=distro%>/intel-ucode.img,/<%=distro%>/initramfs.img ipv6.disable=1 layers=<%=shell_layers%> showopts vga=792
    packages:
      - { install: shell-pkgs }
    configs:
      - { apply: shell-config }

  # Lite
  # ----------------------------------------------------------------------------
  - name: lite
    type: machine
    base: shell
    vars:
      wallpaper: /usr/share/wallpaper/dreamfusion003_1280x1024.jpg
    groups:
      - video
      - audio
    vagrant: { vram: 32, cpus: 2, ram: 2048, v3d: 'on' }
    boot:
      - entry: "Install <%=distro%>-lite           -shell + minimal X11 env"
        kernel: /<%=distro%>/vmlinuz
        initrd: /<%=distro%>/intel-ucode.img,/<%=distro%>/initramfs.img ipv6.disable=1 layers=<%=lite_layers%> showopts vga=792
    packages:
      - { install: lite-pkgs }
    configs:
      - { apply: lite-config }

  # Server
  # ----------------------------------------------------------------------------
  - name: server
    type: machine
    base: lite
    vagrant: { vram: 32, cpus: 2, ram: 2048, v3d: 'on' }
    boot:
      - entry: "Install <%=distro%>-server     -lite + LAMP and services"
        kernel: /<%=distro%>/vmlinuz
        initrd: /<%=distro%>/intel-ucode.img,/<%=distro%>/initramfs.img ipv6.disable=1 layers=<%=server_layers%> showopts autologin=1 vga=792
    packages:
      - { install: server-pkgs }
      - { install: personal-use-pkgs }
    configs:
      - { apply: server-config }

  # Heavy
  # ----------------------------------------------------------------------------
  - name: heavy
    type: machine
    base: lite
    vagrant: { vram: 32, cpus: 2, ram: 2048, v3d: 'on' }
    boot:
      - entry: "Install <%=distro%>-heavy      -lite + more apps"
        kernel: /<%=distro%>/vmlinuz
        initrd: /<%=distro%>/intel-ucode.img,/<%=distro%>/initramfs.img ipv6.disable=1 layers=<%=heavy_layers%> showopts vga=792
    packages:
      - { install: heavy-pkgs }
      - { install: personal-use-pkgs }
    configs:
      - { apply: heavy-config }

  # Theater
  # ----------------------------------------------------------------------------
  - name: theater
    type: machine
    base: heavy
    vars: { fontsize: 18 }
    vagrant: { vram: 32, cpus: 2, ram: 2048, v3d: 'on' }
    boot:
      - entry: "Install <%=distro%>-theater    -heavy + media/kodi"
        kernel: /<%=distro%>/vmlinuz
        initrd: /<%=distro%>/intel-ucode.img,/<%=distro%>/initramfs.img ipv6.disable=1 layers=<%=theater_layers%> showopts vga=792

  # Desktop
  # ----------------------------------------------------------------------------
  - name: desktop
    type: machine
    base: heavy
    groups: [docker]
    vars:
      wallpaper: /usr/share/wallpaper/dreamfusion003_1280x1024.jpg
    vagrant: { vram: 32, cpus: 2, ram: 2048, v3d: 'on' }
    boot:
      - entry: "Install <%=distro%>-desktop   -heavy + dev/office"
        kernel: /<%=distro%>/vmlinuz
        initrd: /<%=distro%>/intel-ucode.img,/<%=distro%>/initramfs.img ipv6.disable=1 layers=<%=desktop_layers%> showopts vga=792
    packages:
      - { install: desktop-pkgs }
    configs:
      - { apply: desktop-config }

  # Live
  # ----------------------------------------------------------------------------
  - name: live
    type: machine
    base: heavy
    vagrant: { vram: 32, cpus: 2, ram: 2048, v3d: 'on' }
    boot:
      - entry: "Start <%=distro%>-live            -live boot env."
        kernel: /<%=distro%>/vmlinuz
        initrd: /<%=distro%>/intel-ucode.img,/<%=distro%>/initramfs.img ipv6.disable=1 layers=<%=live_layers%> showopts vga=792
